@model AuditReportDto
@{
    ViewData["Title"] = "Audit Report";
    int count = 0;
    string result = "";
}
@await Html.PartialAsync("~/Views/Shared/_topbar.cshtml")

<!-- Start new checklist -->
<div class="container bg-lightgrey1 p-2 mt-4 text-dark text-center">
    <div class="row">
        <div class="col-md-6">
            <h5>Supervisor : @Model.AuditMaster.AppUser.Name</h5>
        </div>

        <div class="col-md-6">
            <h5>Division : @Model.AuditMaster.Area.Division.DivName</h5>
        </div>
    </div>
</div>

<section class="container rounded mb-2 border">

    <div class="row p-2 color-myblue text-center">
        <div class="col-md-6 border-right">
            <h6 class="mt-2">WARD 30/HAEMATOLOGY DAY WARD - FR1</h6>
        </div>

        <div class="col-md-3 border-right">
            <h6 class="mt-2">SCORE: @Model.AuditMaster.AuditScore%</h6>
        </div>

        <div class="col-md-3">
            <h6 class="mt-2">@Model.AuditMaster.AuditDate.ToString().Split(' ')[0] - @Model.AuditMaster.AuditDate.ToString().Split(' ')[1]</h6>
        </div>

    </div>
</section>


<section class="container p-0 rounded mb-2 mt-4">
    <h5 class="color-myblue text-center p-2 ">CLEANLINESS ASSURANCE - QUALITY</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">
            <thead>
                <tr class="text-white bg-dark">
                    <th class="gcol5">No</th>
                    <th class="gcol10">Aspect</th>
                    <th class="gcol50">Standard</th>
                    <th class="gcol5">Res</th>
                    <th class="gcol30">Comment</th>
                </tr>
            </thead>

            <tbody>
                @foreach (AuditDetail item in ViewBag.AssuranceQuality)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td>@count</td>
                        <td>Specification</td>
                        <td>@item.Question.QuestText</td>
                        <td>@result</td>
                        <td>@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }
            </tbody>
        </table>
    </div>

    <h5 class="color-myblue text-center p-2 ">INFECTION PREVENTION AND CONTROL ASSURANCE</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.ControlAssurance)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }
            </tbody>
        </table>
    </div>


    <h5 class="color-myblue text-center p-2 ">WASTE SEGREGATION AND MANAGEMENT</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.WasteSegregation)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }

            </tbody>
        </table>
    </div>

    <h5 class="color-myblue text-center p-2 ">CONSUMABLES AND DISPENSERS</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.Consumables)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }
            </tbody>
        </table>
    </div>


    <h5 class="color-myblue text-center p-2 ">ENVIRONMENT</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.Environment)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }

            </tbody>
        </table>
    </div>

    <h5 class="color-myblue text-center p-2 ">STAFF APPEARANCE AND BEHAVIOUR</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.Behaviour)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }
            </tbody>
        </table>
    </div>


    <h5 class="color-myblue text-center p-2 ">DAILY CLEANLINESS MONITORING ASSURANCE</h5>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">

            <tbody>
                @foreach (AuditDetail item in ViewBag.MonitoringAssurance)
                {
                    count += 1;
                    if(item.Result == 1)
                    {
                        result = "YES";
                    }
                    else if(item.Result == 2)
                    {
                        result = "NO";
                    }
                    else
                    {
                        result = "NA";
                    }
                    <tr>
                        <td class="gcol5">@count</td>
                        <td class="gcol10">Specification</td>
                        <td class="gcol50">@item.Question.QuestText</td>
                        <td class="gcol5">@result</td>
                        <td class="gcol30">@item.Comment</td>
                    </tr>
                }

                @{
                    count = 0;
                    result = "";
                }
            </tbody>
        </table>
    </div>
</section>

@if(Model.IsVerified)
{
    <section class="container p-4">
        <hr />
        <h5 class="color-myblue text-center">
                Verified by: @Model.AuditMaster.VerifiedBy - on @Model.AuditMaster.UpdateDt.ToString().Split(' ')[0]
        </h5>
        <h6 class="text-dark">@Model.AuditMaster.VerifyComments</h6>
        <hr />
    </section>
}

<!-- start of verify audits modal -->
<div class="modal fade" id="verifyaudit">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            
            <div class="modal-header bg-light">
                <h5 class="modal-title text-info">
                    <i class="fas fa-clock mr-2"></i>Verify Audit
                </h5>
                <button type="button" class="close" data-dismiss="modal">&times</button>
            </div>

            <div class="modal-body px-4">
                <div class="d-flex justify-content-center">
                    <input id="AuditMasterID" type="hidden" value="@Model.AuditMaster.AuditMasterID"/>
                    <textarea class="form-control formstextstyle mb-2" id="VerifyComments" placeholder="Verification Comments" rows="5"></textarea>
                </div>
                <div>
                    <input type="text" class="form-control formstextstyle" id="VerifiedBy" placeholder="Enter Name">
                </div>

                <div id="response" class="text-danger">
                    
                </div>
            </div>

            <div class="modal-footer">
                <button onclick="VerifyAudit(event)" type="button" class="btn btn-sm btn-info">SAVE</button>
            </div>
        </div>
    </div>
</div>
<!-- End of verify modal -->

<section class="container">
    <div class="row p-2 d-print-none">
        <div class="col-md-4 mb-sm-2">
            <a asp-controller="admin" asp-action="dashboard" class="btn btn-block btn-lg btn-dark">BACK</a>
        </div>

        <div class="col-md-4 mb-sm-2">
            @if(Model.IsVerified)
            {
                <a href="#" 
                    class="btn btn-block btn-lg btn-info disabled" 
                    data-toggle="modal" 
                    data-target="#verifyaudit">VERIFIED</a>
            }
            else
            {
                <a href="#" 
                    class="btn btn-block btn-lg btn-info" 
                    data-toggle="modal" 
                    data-target="#verifyaudit">VERIFY AUDIT</a>
            }
        </div>

        <div class="col-md-4">
            <button class="btn btn-block btn-lg btn-success" onclick="window.print()">PRINT</button>
        </div>
    </div>
</section>

<script>
    function VerifyAudit(e){
        var response = $('#response');
        var verifyaudit = $('#verifyaudit');
        let obj = {
            MasterId: $('#AuditMasterID').val(),
            VerifyComments: $('#VerifyComments').val(),
            VerifiedBy: $('#VerifiedBy').val(),
        }

        $.ajax({
            url: "@Url.Action("VerifyAudit", "Admin")",//'/JobManagement/OnAddingScreeningQuestions',
            method: "POST",
            data: { pVerifyAuditDto: obj },
            dataType: "json",
            success: function (data) {
                if (data.hasError) {
                    response.text(data.message);
                    verifyaudit.modal({
                      keyboard: false,
                      show: true,
                      backdrop: true,
                      focus: true
                    });
                } else {
                    response.removeClass('text-danger').addClass('text-success').text(data.message);
                    setTimeout(()=>{
                        verifyaudit.modal('hide');
                        location.reload();
                    }, 2000);
                }
            },
            error: function (data) {
                if (data.hasError) {
                    alert(data.message);
                }
            }
        });
    }
</script>
