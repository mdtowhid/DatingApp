@model DashboardDto
@using X.PagedList;
@using X.PagedList.Mvc.Core;
@using X.PagedList.Mvc.Common;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers;
@{
    ViewData["Title"] = "Audit List";
    IPagedList<AuditMaster>? vAuditMasterList = ViewBag.AuditMasterList as IPagedList<AuditMaster>;
}
@await Html.PartialAsync("~/Views/Shared/_topbar.cshtml")

@if (Model.IsSearched)
{
    <!-- Modal -->
    <div class="modal fade show" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" style="display: block; padding-right: 17px; background: rgba(0,0,0,0.5);" aria-modal="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Search Information</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    No Audit Found.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
}

<!-- Start of  grid -->
<section class="container p-0 mt-4">
    <h4 class="color-myblue mb-3 text-center">VIEW AND VERIFY AUDITS</h4>
    <!-- Search form -->
        <form enctype="multipart/form-data"
              asp-controller="Admin"
              asp-action="AuditList"
              method="post">
        <div class="row">
            <div class="col-md-3 input-group mb-3 d-print-none">
                <input name="fromDate" class="form-control formstextstyle docs-date"
                       placeholder="From" autocomplete="off" data-toggle="tooltip" data-placement="top"
                       title="From Date">
                <div class="input-group-append">
                    <a href="#" class="input-group-text px-2">
                        <i class="fas fa-calendar" aria-hidden="true"></i>
                    </a>
                </div>
            </div>

            <div class="col-md-3 input-group mb-3 d-print-none">
                <input name="toDate" class="form-control formstextstyle docs-date"
                       placeholder="To" autocomplete="off" data-toggle="tooltip" data-placement="top"
                       title="To Date">
                <div class="input-group-append">
                    <a href="#" class="input-group-text px-2">
                        <i class="fas fa-calendar" aria-hidden="true"></i>
                    </a>
                </div>
            </div>

            <div class="col-md-6 input-group mb-3 d-print-none">
                <input name="pSearchKey" class="form-control formstextstyle"
                       data-toggle="tooltip"
                       data-placement="top" title="Search audits by area name" id="searchname"
                       placeholder="Search Audits">
                <div class="input-group-append">
                    <button type="submit" class="input-group-text px-2">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </div>
     </form>
    <div class="table-responsive">
        <table class="table table-light table-striped table-hover table-bordered small">
            <thead>
                <tr class="text-white bg-lightgrey2">
                    <th class="gcol25">Date</th>
                    <th class="gcol40">Area</th>
                    <th class="gcol5">FR</th>
                    <th class="gcol20">Supervisor</th>
                    <th class="gcol5">Score</th>
                    <th class="gcol5">Status</th>
                    <th class="gcol5">View</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var auditMaster in vAuditMasterList)
                {
                    <tr>
                        <td>@auditMaster.AuditDate</td>
                        <td>@auditMaster.Area.AreaName</td>
                        <td>FR1</td>
                        <td>@auditMaster.AppUser.Name</td>
                        <td>@auditMaster.AuditScore%</td>
                        @if (auditMaster.AuditStatus == 1)
                        {
                            <td class="text-center">
                                <i class="fas fa-check fa-lg text-success"
                                   data-toggle="tooltip" data-placement="right"
                                   title="Audit Complete">
                                </i>
                            </td>
                        }
                        else
                        {
                            <td class="text-center">
                                <i class="fas fa-check-double fa-lg text-success"
                                   data-toggle="tooltip" data-placement="right"
                                   title="Audit Completed and Verified"></i>
                            </td>
                        }

                        <td class="text-center">
                            <a asp-controller="admin"
                               asp-action="AuditReport"
                               asp-route-pAuditMasterID="@auditMaster.AuditMasterID">
                                <i class="fas fa-info-circle fa-lg text-info"
                                   data-toggle="tooltip" data-placement="right"
                                   title="View Report">
                                </i>
                            </a>
                        </td>
                    </tr>
                }

            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    @if (vAuditMasterList != null && vAuditMasterList.Count > 0)
    {
        @Html.PagedListPager(vAuditMasterList,
        page => Url.Action("Dashboard", "Admin", new { pPage = page }))
    }
    <!-- End of pagination -->


    <div class="row p-2 d-print-none">
        <div class="col-md-4 mb-sm-2">
            <a asp-controller="admin" asp-action="dashboard" class="btn btn-block btn-lg btn-dark">BACK</a>
        </div>
        <div class="col-md-8">
            <button class="btn btn-block btn-lg btn-success" onclick="window.print()">PRINT</button>
        </div>
    </div>

</section>
<!-- End of rooms grid -->

<script>
   $(document).ready(() => {
        $('#exampleModal').modal('toggle');
    });
</script>